<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Flappy Connecta</title>

<style>
    body {
        margin: 0;
        overflow: hidden;
        touch-action: manipulation; /* evita zoom no telemóvel */
        background: linear-gradient(to bottom, #87CEEB, #fff);
        font-family: Arial, sans-serif;
    }
    #score {
        position: absolute;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        font-size: 32px;
        font-weight: bold;
        color: red;
        text-shadow: 2px 2px #fff;
    }
    #menu {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.5);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: white;
    }
    #menu h1 {
        font-size: 64px;
        margin-bottom: 40px;
        text-shadow: 3px 3px green;
    }
    #menu button {
        font-size: 32px;
        padding: 15px 40px;
        background-color: red;
        color: white;
        border: none;
        border-radius: 12px;
        cursor: pointer;
        box-shadow: 3px 3px 6px #000;
    }
</style>
</head>
<body>

<div id="menu">
    <h1>Flappy Connecta</h1>
    <button id="startBtn">Jogar</button>
</div>

<canvas id="gameCanvas"></canvas>
<div id="score">0</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

// Ajustar ao tamanho do ecrã
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

window.addEventListener("resize", () => {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
});

const santa = new Image();
santa.src = "d3842755-ae5d-474a-85be-5d4935244979.png";

// Física optimizada para telemóvel
let gravity = 0.4;
let lift = -7;
let velocity = 0;
let santaY = canvas.height / 2;
let santaX = canvas.width * 0.15;

let pipes = [];
let pipeWidth = 80;
let pipeGap = canvas.height * 0.30;
let frame = 0;
let score = 0;

// Menos neve = melhor FPS no telemóvel
const snowflakes = [];
for (let i = 0; i < 40; i++) {
    snowflakes.push({
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height,
        r: Math.random() * 2 + 1,
        d: Math.random() * 1 + 0.5
    });
}

function createPipe() {
    let topHeight = Math.random() * (canvas.height - pipeGap - 100) + 50;

    pipes.push({
        x: canvas.width,
        top: topHeight,
        bottom: topHeight + pipeGap
    });
}

function checkCollision(p) {
    if (
        santaX + 40 > p.x && santaX < p.x + pipeWidth &&
        (santaY < p.top || santaY + 40 > p.bottom)
    ) return true;

    if (santaY + 40 > canvas.height || santaY < 0) return true;

    return false;
}

function gameOver() {
    const menu = document.getElementById("menu");
    menu.style.display = "flex";
    menu.innerHTML = `
        <h1>Game Over!</h1>
        <p>Pontuação: ${score}</p>
        <button onclick="location.reload()">Jogar novamente</button>
    `;
}

function update() {
    frame++;
    velocity += gravity;
    santaY += velocity;

    if (frame % 100 === 0) createPipe();

    for (let i = pipes.length - 1; i >= 0; i--) {
        pipes[i].x -= 3;

        if (pipes[i].x + pipeWidth < 0) {
            pipes.splice(i, 1);
            score++;
            document.getElementById("score").innerText = score;
        }

        if (checkCollision(pipes[i])) {
            gameOver();
            return;
        }
    }

    draw();
    requestAnimationFrame(update);
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Neve
    ctx.fillStyle = "white";
    for (let flake of snowflakes) {
        ctx.beginPath();
        ctx.arc(flake.x, flake.y, flake.r, 0, Math.PI * 2);
        ctx.fill();
        flake.y += flake.d;
        if (flake.y > canvas.height) {
            flake.y = 0;
            flake.x = Math.random() * canvas.width;
        }
    }

    // Pai Natal
    ctx.drawImage(santa, santaX, santaY, 50, 50);

    // Pipes
    ctx.fillStyle = "green";
    for (let p of pipes) {
        ctx.fillRect(p.x, 0, pipeWidth, p.top);
        ctx.fillRect(p.x, p.bottom, pipeWidth, canvas.height - p.bottom);
    }
}

// Controlo por toque
document.addEventListener("touchstart", (e) => {
    e.preventDefault();
    velocity = lift;
}, { passive: false });

// Controlo por rato/PC
document.addEventListener("mousedown", () => velocity = lift);

// Teclado
document.addEventListener("keydown", () => velocity = lift);

// Iniciar jogo
document.getElementById("startBtn").addEventListener("click", () => {
    document.getElementById("menu").style.display = "none";
    update();
});
</script>

</body>
</html>
