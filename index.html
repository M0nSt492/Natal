<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<title>Flappy Connecta</title>
<link href="https://fonts.googleapis.com/css2?family=Mountains+of+Christmas:wght@700&display=swap" rel="stylesheet">
<style>
    body {
        margin: 0;
        overflow: hidden;
        background: linear-gradient(to bottom, #87CEEB, #fff);
        font-family: 'Mountains of Christmas', cursive;
    }
    canvas {
        display: block;
        margin: 0 auto;
        background: transparent;
    }
    #score {
        position: absolute;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        font-size: 32px;
        font-weight: bold;
        color: red;
        text-shadow: 2px 2px #fff;
    }
    #menu {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.5);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: white;
    }
    #menu h1 {
        font-size: 64px;
        margin-bottom: 40px;
        text-shadow: 3px 3px green;
    }
    #menu button {
        font-family: 'Mountains of Christmas', cursive;
        font-size: 32px;
        padding: 15px 40px;
        background-color: red;
        color: white;
        border: none;
        border-radius: 12px;
        cursor: pointer;
        box-shadow: 3px 3px 6px #000;
    }
    #menu button:hover {
        background-color: darkred;
    }
</style>
</head>
<body>

<div id="menu">
    <h1>Flappy Connecta</h1>
    <button id="startBtn">Jogar</button>
</div>

<audio id="bgMusic" loop>
    <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
</audio>

<canvas id="gameCanvas" width="400" height="600"></canvas>
<div id="score">0</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

const santa = new Image();
santa.src = 'd3842755-ae5d-474a-85be-5d4935244979.png';

let gravity = 0.6;
let lift = -10;
let velocity = 0;
let santaY = canvas.height/2;
let santaX = 50;

let pipes = [];
let pipeWidth = 60;
let pipeGap = 150;
let frame = 0;
let score = 0;

const pipeNamesOriginal = ["WIZINK", "EDP", "CETELEM", "SONAE", "RECURSOS HUMANOS", "SISTEMAS DE INFORMAÇÃO"];
let pipeNames = [...pipeNamesOriginal];

const snowflakes = [];
for(let i=0;i<100;i++){
    snowflakes.push({x: Math.random()*canvas.width, y: Math.random()*canvas.height, r: Math.random()*3+1, d: Math.random()*2});
}

function createPipe() {
    let topHeight = Math.random() * (canvas.height - pipeGap - 50) + 50;
    let bottomY = topHeight + pipeGap;
    
    if(pipeNames.length === 0) pipeNames = [...pipeNamesOriginal];
    const nameIndex = Math.floor(Math.random() * pipeNames.length);
    const name = pipeNames.splice(nameIndex,1)[0];

    pipes.push({x: canvas.width, top: topHeight, bottom: bottomY, name: name});
}

function checkCollision(pipe) {
    if (
        santaX + 40 > pipe.x && santaX < pipe.x + pipeWidth &&
        (santaY < pipe.top || santaY + 40 > pipe.bottom)
    ) return true;

    if (santaY + 40 > canvas.height || santaY < 0) return true;

    return false;
}

function gameOver() {
    const menu = document.getElementById('menu');
    menu.style.display = 'flex';
    menu.innerHTML = `<h1>Game Over!</h1>
                      <p>Pontuação: ${score}</p>
                      <button id="restartBtn">Jogar novamente</button>`;
    
    document.getElementById('restartBtn').addEventListener('click', () => {
        location.reload();
    });
}

function update() {
    frame++;
    velocity += gravity;
    santaY += velocity;

    if (frame % 90 === 0) createPipe();

    for (let i = pipes.length - 1; i >= 0; i--) {
        pipes[i].x -= 2;

        if (pipes[i].x + pipeWidth < 0) {
            pipes.splice(i, 1);
            score++;
            document.getElementById('score').innerText = score;
        }

        if (checkCollision(pipes[i])) {
            gameOver();
            return;
        }
    }

    draw();
    requestAnimationFrame(update);
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Neve
    ctx.fillStyle = 'white';
    ctx.beginPath();
    for(let flake of snowflakes){
        ctx.moveTo(flake.x, flake.y);
        ctx.arc(flake.x, flake.y, flake.r, 0, Math.PI*2);
    }
    ctx.fill();

    for(let flake of snowflakes){
        flake.y += flake.d;
        if(flake.y > canvas.height){
            flake.y = 0;
            flake.x = Math.random()*canvas.width;
        }
    }

    // Pai Natal inclinado
    ctx.save();
    ctx.translate(santaX + 20, santaY + 20);
    let angle = velocity / 10;
    if(angle > 0.5) angle = 0.5;
    if(angle < -0.5) angle = -0.5;
    ctx.rotate(angle);
    ctx.drawImage(santa, -20, -20, 40, 40);
    ctx.restore();

    // Pipes
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";

    for (let pipe of pipes) {
        // Retângulos
        ctx.fillStyle = 'green';
        ctx.fillRect(pipe.x, 0, pipeWidth, pipe.top);
        ctx.fillStyle = 'red';
        ctx.fillRect(pipe.x, pipe.bottom, pipeWidth, canvas.height - pipe.bottom);

        // Determinar retângulo maior para centralizar o texto
        let rectHeight, rectTop;
        if(pipe.top >= (canvas.height - pipe.bottom)) {
            rectHeight = pipe.top;
            rectTop = 0;
        } else {
            rectHeight = canvas.height - pipe.bottom;
            rectTop = pipe.bottom;
        }

        // Texto vertical
        ctx.fillStyle = 'white';
        let fontSize = Math.min(16, rectHeight / (pipe.name.length + 1));
        ctx.font = `${fontSize}px Arial`;

        let startY = rectTop + (rectHeight - fontSize * pipe.name.length)/2 + fontSize/2;
        for(let i=0; i<pipe.name.length; i++){
            ctx.fillText(pipe.name[i], pipe.x + pipeWidth/2, startY + i*fontSize);
        }
    }
}

document.addEventListener('keydown', () => velocity = lift);
document.addEventListener('click', () => velocity = lift);

document.getElementById('startBtn').addEventListener('click', () => {
    document.getElementById('menu').style.display = 'none';
    document.getElementById('bgMusic').play();
    
    if (santa.complete) {
        update();
    } else {
        santa.onload = update;
    }
});
</script>

</body>
</html>
